<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy Birthday!</title>
<style>
  :root{
    --bg1: #FFDEE9;
    --bg2: #B5FFFC;
    --accent: #FF6B6B;
    --card: rgba(255,255,255,0.9);
    --glass: rgba(255,255,255,0.12);
    --text: #2b2b2b;
  }

  html,body{height:100%;}
  body{
    margin:0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color:var(--text);
    background: linear-gradient(135deg,var(--bg1) 0%, var(--bg2) 100%);
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
  }

  .card{
    width: min(920px, 94vw);
    max-width: 920px;
    background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.78));
    box-shadow: 0 10px 30px rgba(20,20,20,0.12);
    border-radius:18px;
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:1rem;
    padding:20px;
    align-items:center;
    position:relative;
    overflow:visible;
    backdrop-filter: blur(6px);
  }

  @media (max-width:820px){
    .card{grid-template-columns:1fr; padding:16px;}
    .side {order:-1;}
  }

  .left{ padding:18px 12px; }
  .headline{
    font-size: clamp(22px, 3.6vw, 34px);
    margin:6px 0 12px 0;
    line-height:1.05;
    font-weight:700;
    letter-spacing: -0.02em;
  }
  .sub{
    font-size: clamp(14px, 2.2vw, 16px);
    color:#4d4d4d;
    margin-bottom:16px;
  }

  .big-message{
    font-size: clamp(16px, 2.4vw, 20px);
    padding:14px;
    background: linear-gradient(90deg, rgba(255,255,255,0.4), rgba(255,255,255,0.2));
    border-radius:12px;
    border:1px solid rgba(0,0,0,0.04);
  }

  .controls{
    margin-top:14px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
  }
  button{
    appearance:none;
    border:0;
    padding:10px 14px;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  }
  .btn-ghost{
    background:transparent;
    border:1px solid rgba(0,0,0,0.06);
    color:var(--text);
  }

  .side{
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:center;
    padding:10px;
  }
  .portrait{
    width:320px;
    height:320px;
    border-radius:16px;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(180deg,#fff, #fff0);
    position:relative;
    box-shadow: 0 8px 30px rgba(0,0,0,0.08);
    border:1px solid rgba(255,255,255,0.6);
  }
  .portrait img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }

  /* Cake container to be clickable */
  .cake-wrap{
    position:relative;
    width:160px;
    height:160px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
  }
  .cake-wrap:focus{ outline: 3px solid rgba(255,186,107,0.25); border-radius:14px; }

  /* Tooltip / prompt */
  .prompt{
    position:absolute;
    bottom:-32px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(255,255,255,0.95);
    padding:6px 10px;
    border-radius:999px;
    font-size:13px;
    box-shadow:0 8px 18px rgba(0,0,0,0.08);
    border:1px solid rgba(0,0,0,0.04);
    white-space:nowrap;
  }

  /* flame & candle animation */
  .flame{
    transform-origin:center bottom;
    animation:flame-flicker 900ms infinite;
  }
  @keyframes flame-flicker{
    0% { transform: scaleY(1) translateY(0); opacity:1; }
    50% { transform: scaleY(0.9) translateY(-1px); opacity:0.95; }
    100% { transform: scaleY(1) translateY(0); opacity:1; }
  }
  .flame.extinguished{
    animation: none;
    transform: scaleY(0.02) translateY(6px);
    opacity:0;
    transition: transform .45s ease, opacity .45s ease;
  }

  /* smoke */
  .smoke{
    position:absolute;
    left:50%;
    top:26%;
    width:8px;
    height:8px;
    border-radius:50%;
    opacity:0;
    pointer-events:none;
  }
  /* fade & float path for smoke generated in JS */

  /* confetti canvas */
  canvas.confetti{
    position:fixed;
    left:0; top:0;
    width:100vw; height:100vh;
    pointer-events:none;
    z-index:9999;
  }

  .surprise{ margin-top:12px; padding:12px; border-radius:12px; background:var(--glass); border:1px dashed rgba(0,0,0,0.06); display:none; animation:pop .45s ease; }
  .surprise.show{display:block;}
  @keyframes pop{ from {transform:scale(.98);opacity:0} to {transform:scale(1);opacity:1} }

  .footer-note{ font-size:12px; color:#666; margin-top:12px; }

</style>
</head>
<body>
  <canvas id="confettiCanvas" class="confetti" aria-hidden="true"></canvas>

  <div class="card" role="main" aria-labelledby="title">
    <div class="left">
      <h1 id="title" class="headline">Happy Birthday, <span id="namePlace">Friend</span> üéâ</h1>
      <div class="sub" id="subline">A little site made just for you ‚Äî blow the candle and make a wish!</div>

      <div class="big-message" id="shortMsg">
        Wishing you a day filled with love, laughter, and your favourite cake.
      </div>

      <div class="controls">
        <button class="btn-ghost" id="playBtn">‚ñ∂Ô∏è Play/Stop Music</button>
        <a class="btn-ghost" id="downloadBtn" href="#" download="birthday-portrait.png">üì∑ Save Portrait</a>
      </div>

      <div class="surprise" id="surpriseArea" aria-live="polite">
        <h3 style="margin:6px 0 8px 0">To the amazing <span id="namePlace2">Friend</span> ‚Äî</h3>
        <p id="longMsg">You brighten every room and make life more fun. Today we celebrate you for the kindness, the laughs, and the memories. Happy birthday ‚Äî here's to a year full of adventures, joy, and success. Love you!</p>
        <div class="footer-note">Click the candle to blow it. Press <strong>B</strong> on your keyboard to blow too.</div>
      </div>
    </div>

    <div class="side">
      <div class="portrait" title="Click the candle to blow the wish">
        <img id="portraitImg" src="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=placeholder" alt="Birthday photo">
        <!-- cake area placed on top -->
        <div class="cake-wrap" id="cakeWrap" tabindex="0" role="button" aria-pressed="false" aria-label="Cake with candle. Click the candle to blow it.">
          <!-- SVG cake with candle & flame -->
          <svg id="cakeSvg" width="140" height="140" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Birthday cake with candle">
            <!-- cake body -->
            <rect x="6" y="30" width="52" height="18" rx="3" fill="#FFFBF0"/>
            <path d="M6 30c6-6 18-6 26-1 8-5 20-5 26 1" fill="#FFD9D9"/>
            <!-- candles (decorative pillars) -->
            <rect x="21" y="34" width="2.5" height="8" rx="0.6" fill="#FF6B6B"/>
            <rect x="30.5" y="34" width="2.5" height="8" rx="0.6" fill="#FFB86B"/>
            <rect x="39.5" y="34" width="2.5" height="8" rx="0.6" fill="#72E0FF"/>
            <!-- single main candle center -->
            <rect id="candleBody" x="30" y="22" width="4" height="12" rx="0.8" fill="#FFFFFF" stroke="#FFF2D8" stroke-width="0.8"/>
            <!-- flame group (click target is this group) -->
            <g id="flameGroup" style="cursor:pointer" transform="translate(0,0)">
              <path id="flame" class="flame" d="M32 17.2c0 2.6-2 3.8-2 3.8s0-2 0-3.8 1-2.4 2-2.4 1 0.6 1 2.4z" fill="#FFD66B"/>
              <path id="flameInner" class="flame" d="M32 18c0 1.5-1.1 2.2-1.1 2.2s0-1 0-2.2 0.6-1.4 1.1-1.4 1 0.3 1 1.4z" fill="#FFB86B" opacity="0.95"/>
            </g>
          </svg>

          <!-- prompt below cake -->
          <div class="prompt" id="cakePrompt">Click the candle to blow it üí®</div>
        </div>
      </div>
    </div>
  </div>

<script>
/* Personalization */
const recipientName = "Alex";          // change name
const shortMessage = "Wishing you a day filled with love, laughter, and your favourite cake.";
const longMessage = "You brighten every room and make life more fun. Today we celebrate you for the kindness, the laughs, and the memories. Happy birthday ‚Äî here's to a year full of adventures, joy, and success. Love you!";
const portraitURL = ""; // optional portrait url
const musicURL = "";    // optional mp3 url

/* Fill DOM */
document.getElementById('namePlace').textContent = recipientName;
document.getElementById('namePlace2').textContent = recipientName;
document.getElementById('shortMsg').textContent = shortMessage;
document.getElementById('longMsg').textContent = longMessage;
if (portraitURL) document.getElementById('portraitImg').src = portraitURL;

/* Confetti implementation (same lightweight one) */
const confettiCanvas = document.getElementById('confettiCanvas');
function Confetti(canvas) {
  this.canvas = canvas;
  this.ctx = canvas.getContext('2d');
  this.particles = [];
  this.running = false;
  this.resize();
  window.addEventListener('resize', ()=>this.resize());
}
Confetti.prototype.resize = function(){
  const dpr = window.devicePixelRatio || 1;
  this.canvas.width = Math.max(innerWidth, 300) * dpr;
  this.canvas.height = Math.max(innerHeight, 300) * dpr;
  this.ctx.setTransform(dpr,0,0,dpr,0,0);
};
Confetti.prototype.start = function(){
  if (this.running) return;
  this.running = true;
  for(let i=0;i<120;i++) this.particles.push(this.spawn());
  this.last = performance.now();
  this.run();
};
Confetti.prototype.stop = function(){
  this.running = false;
  setTimeout(()=> this.particles = [], 800);
  this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);
};
Confetti.prototype.spawn = function(){
  const w = innerWidth, h = innerHeight;
  return {
    x: Math.random()*w,
    y: -10 - Math.random()*h*0.2,
    size: 6 + Math.random()*8,
    tilt: Math.random()*Math.PI,
    speedY: 2 + Math.random()*5,
    speedX: -2 + Math.random()*4,
    angle: Math.random()*Math.PI*2,
    rotateSpeed: (-0.04 + Math.random()*0.08),
    color: ["#FF6B6B","#FFB86B","#FFD66B","#72E0FF","#C2F7FF","#C7F7D6"][Math.floor(Math.random()*6)]
  };
};
Confetti.prototype.update = function(dt){
  for (let p of this.particles){
    p.y += p.speedY * dt * 0.06;
    p.x += p.speedX * dt * 0.06;
    p.angle += p.rotateSpeed * dt * 0.06;
    if (p.y > innerHeight + 40) {
      Object.assign(p, this.spawn());
      p.y = -20;
    }
  }
};
Confetti.prototype.draw = function(){
  const ctx = this.ctx;
  ctx.clearRect(0,0, this.canvas.width, this.canvas.height);
  for (let p of this.particles){
    ctx.save();
    ctx.translate(p.x, p.y);
    ctx.rotate(p.angle);
    ctx.fillStyle = p.color;
    ctx.fillRect(-p.size/2, -p.size/2, p.size, Math.max(2,p.size*0.6));
    ctx.restore();
  }
};
Confetti.prototype.run = function(){
  if (!this.running) return;
  const now = performance.now();
  const dt = now - (this.last || now);
  this.last = now;
  this.update(dt);
  this.draw();
  requestAnimationFrame(()=>this.run());
};
const confetti = new Confetti(confettiCanvas);

/* Candle / blow logic */
const flame = document.getElementById('flame');
const flameInner = document.getElementById('flameInner');
const flameGroup = document.getElementById('flameGroup');
const cakeWrap = document.getElementById('cakeWrap');
const cakePrompt = document.getElementById('cakePrompt');
const surpriseArea = document.getElementById('surpriseArea');

let blown = false;
let blowing = false;

/* helper: create smoke element and animate */
function makeSmoke() {
  const s = document.createElement('div');
  s.className = 'smoke';
  // randomize size & left offset
  const size = 8 + Math.random()*12;
  s.style.width = size + 'px';
  s.style.height = size + 'px';
  s.style.left = (cakeWrap.offsetLeft + cakeWrap.offsetWidth/2 - size/2 + (Math.random()*12-6)) + 'px';
  s.style.top = (cakeWrap.offsetTop + cakeWrap.offsetHeight*0.18) + 'px';
  s.style.opacity = '0';
  document.body.appendChild(s);

  // animate using Web Animations / CSS
  const driftX = (-12 + Math.random()*24);
  const rise = -70 - Math.random()*40;
  s.animate([
    { transform: 'translate(0px, 0px) scale(0.6)', opacity: 0 },
    { transform: `translate(${driftX}px, ${rise}px) scale(1.1)`, opacity: 0.65 },
    { transform: `translate(${driftX*1.2}px, ${rise-30}px) scale(1.6)`, opacity: 0.12 }
  ], {
    duration: 1200 + Math.random()*600,
    easing: 'cubic-bezier(.2,.7,.2,1)'
  }).onfinish = () => s.remove();
}

/* show intermediate message using aria-live */
function announce(text) {
  surpriseArea.classList.add('show');
  surpriseArea.querySelector('p').textContent = text;
}

/* blow action */
async function blowCandle() {
  if (blown || blowing) return;
  blowing = true;
  cakeWrap.setAttribute('aria-pressed','true');
  cakePrompt.textContent = "Making a wish... üéà";
  announce("Make a wish... blowing the candle!");

  // quick "puff" sound (WebAudio tiny)
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = 'triangle';
    o.frequency.value = 1400;
    g.gain.value = 0.0005;
    o.connect(g); g.connect(ctx.destination);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.02, ctx.currentTime + 0.02);
    g.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime + 0.22);
    o.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.22);
    o.stop(ctx.currentTime + 0.26);
  } catch(e){ /* ignore audio issues */ }

  // animate flame shrinking (CSS class)
  flame.classList.add('extinguished');
  flameInner.classList.add('extinguished');

  // create a small burst of smoke
  setTimeout(()=> { makeSmoke(); makeSmoke(); }, 120);
  setTimeout(()=> { makeSmoke(); }, 300);

  // small delay then show confetti
  setTimeout(()=>{
    confetti.start();
    setTimeout(()=>{ confetti.stop(); }, 7000);
    // update prompt & message
    cakePrompt.textContent = "Wish made! ‚ú®";
    announce(longMessage);
    blown = true;
    blowing = false;
  }, 600);
}

/* Click & keyboard support */
flameGroup.addEventListener('click', (e)=> {
  e.stopPropagation();
  blowCandle();
});
cakeWrap.addEventListener('click', (e)=>{
  // if user clicks outside flame but still within cake area, focus the flame
  if (!blown) {
    blowCandle();
  }
});

/* keyboard 'B' to blow */
window.addEventListener('keydown', (ev)=>{
  if (ev.key.toLowerCase() === 'b') blowCandle();
});

/* Accessibility: when focused show prompt */
cakeWrap.addEventListener('focus', ()=> { cakePrompt.style.transform = 'translateX(-50%) scale(1)'; });
cakeWrap.addEventListener('blur', ()=> { /* keep prompt visible */ });

/* Small UX: hide prompt after blow sequence */
function hidePromptLater() {
  setTimeout(()=> {
    if (blown) cakePrompt.style.opacity = '0.85';
  }, 1200);
}
setInterval(()=>{ /* subtle breathing for prompt to catch attention */
  cakePrompt.animate([{ transform:'translateX(-50%) translateY(0)' }, { transform:'translateX(-50%) translateY(-3px)' }, { transform:'translateX(-50%) translateY(0)'}], { duration:2000, iterations:1 });
}, 4200);

/* Music button (optional) */
let audio = null;
const playBtn = document.getElementById('playBtn');
if (musicURL){
  audio = new Audio(musicURL);
  audio.loop = true;
  audio.volume = 0.75;
}
playBtn.addEventListener('click', ()=>{
  if (!audio){
    // gentle click sound as fallback
    try {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'sine'; o.frequency.value = 880;
      g.gain.value = 0.0001;
      o.connect(g); g.connect(ctx.destination);
      o.start();
      g.gain.exponentialRampToValueAtTime(0.03, ctx.currentTime + 0.02);
      g.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime + 0.35);
      o.stop(ctx.currentTime + 0.36);
    } catch(e){}
    return;
  }
  if (audio.paused){ audio.play(); playBtn.textContent = "‚è∏ Stop Music"; }
  else { audio.pause(); playBtn.textContent = "‚ñ∂Ô∏è Play/Stop Music"; }
});

/* Portrait download (same cross-origin safe approach) */
const downloadBtn = document.getElementById('downloadBtn');
downloadBtn.addEventListener('click', async (e)=>{
  e.preventDefault();
  const imgEl = document.getElementById('portraitImg');
  try {
    const resp = await fetch(imgEl.src, {mode:'cors'});
    const blob = await resp.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${recipientName || 'birthday'}-portrait.png`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  } catch(err){
    alert("Couldn't download image due to browser restrictions. Try right-clicking the picture and saving it.");
  }
});
</script>
</body>
</html>
